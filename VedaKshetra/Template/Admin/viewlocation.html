{% load static %}
{% include 'Admin/header.html' %}
<script src="{% static 'Admin/jquery-3.7.1.min.js' %}"></script>
<script>
    $(document).ready(function() {
        $.ajaxSetup({
            headers: { "X-CSRFToken": '{{ csrf_token }}' }
        });

        $('#district_id').change(function () {
            var district_id = $(this).val();
            $.ajax({
                type: "POST",
                url: '{% url "filllocation" %}',
                data: { did: district_id },
                dataType: "json",
                success: function (data) {
                    $('#locations').empty();
                    var s = 1;
                    $.each(data, function (key, val) {
                        var id = val.location_id;
                        var deleteurl = '{% url "deletelocation" 0 %}'.replace('0', id);
                        var editurl = '{% url "editlocation" 0 %}'.replace('0', id); 

                        var row = '<tr> <td>' + s++ + '</td>' +
                                  '<td>' + val.location_name + '</td>' +
                                  '<td class="text-center">' +
                                    '<div class="d-flex justify-content-center align-items-center">' +
                                        '<a href="' + editurl + '" class="btn btn-warning btn-sm mx-2 px-4">' +
                                            '<i class="fa fa-edit"></i> Edit' +
                                        '</a>' +
                                        '<a href="' + deleteurl + '" class="btn btn-danger btn-sm mx-2 px-4" onclick="return confirm(\'Are you sure?\')">' +
                                            '<i class="fa fa-trash"></i> Delete' +
                                        '</a>' +
                                    '</div>' +
                                  '</td>' +
                                  '</tr>';
                        $('#locations').append(row);
                    });
                }
            });
        });
    });
</script>

<!-- Main content -->
<div class="col-lg-12 grid-margin stretch-card">
    <div class="card">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h4 class="card-title" style="font-size: 24px; font-weight: 600;">Location Details</h4>   
            </div>
            
            <!-- Updated Back to Location Button (Red) -->
            <a href="{% url 'location' %}" class="btn btn-danger btn-sm">
                <i class="fa fa-arrow-left"></i> Back to Location
            </a>

            <br><br>

            <!-- District Select Dropdown -->
            <div class="form-group">
                <label for="district_id" style="font-size: 16px; font-weight: 500;">Select District</label>
                <select name="district_id" id="district_id" class="form-control form-control-lg" required>
                    <option value="">Select District</option>
                    {% for d in district %}
                        <option value="{{ d.district_id }}">{{ d.district_name }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- Location Table -->
            <table class="table table-striped table-bordered mt-4">
                <thead class="thead-dark">
                    <tr>
                        <th>Sl. No</th>
                        <th>Location Name</th>
                        <th class="text-center">Actions</th>
                    </tr>
                </thead>
                <tbody id="locations">
                    <!-- Data will be populated via AJAX -->
                </tbody>
            </table>
        </div>
    </div>
</div>

{% include 'Admin/footer.html' %}
