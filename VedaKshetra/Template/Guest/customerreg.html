<!DOCTYPE html>
<html lang="en">
{% load static %}
{% include 'Guest/header.html' %}
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Customer Registration</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <script src="{% static 'Admin/jquery-3.7.1.min.js' %}"></script>

  <script>
    $(document).ready(function() {
      $.ajaxSetup({ headers: {"X-CSRFToken": '{{csrf_token}}' } });

      $("#district").change(function() {
        var district_id = $(this).val();
        $('#location').html('<option value="0">Select Location</option>');

        if (district_id) {
          $.ajax({
            type: "POST",
            url: '{% url "filllocation" %}',
            data: { did: district_id },
            dataType: "json",
            success: function(data) {
              $.each(data, function(key, val) {
                $('#location').append("<option value='" + val.location_id + "'>" + val.location_name + "</option>");
              });
            }
          });
        }
      });

      // Prevent username & password autofill
      setTimeout(function() {
        document.getElementById("username").value = "";
        document.getElementById("password").value = "";
      }, 100);

      // Client-side validation before submitting
      $("form").submit(function(e) {
        let isValid = true;

        let name = $("#customer_name").val();
        if (!/^[A-Za-z\s]{3,}$/.test(name)) {
          alert("Name should be at least 3 characters long and contain only letters.");
          isValid = false;
        }

        let phone = $("#phone").val();
        if (!/^\d{10}$/.test(phone)) {
          alert("Phone number must be exactly 10 digits.");
          isValid = false;
        }

        let username = $("#username").val();
        if (!/^[a-zA-Z0-9_]{3,}$/.test(username)) {
          alert("Username should have at least 3 characters and only contain letters, numbers, and underscores.");
          isValid = false;
        }

        let password = $("#password").val();
        if (!/^(?=.*[0-9])(?=.*[!@#$%^&*])[A-Za-z\d!@#$%^&*]{8,}$/.test(password)) {
          alert("Password must be at least 8 characters, including 1 number and 1 special character.");
          isValid = false;
        }

        let address = $("#address").val();
        if (address.length < 5) {
          alert("Address should be at least 5 characters long.");
          isValid = false;
        }

        if ($("#district").val() == "Choose...") {
          alert("Please select a district.");
          isValid = false;
        }

        if ($("#location").val() == "0") {
          alert("Please select a location.");
          isValid = false;
        }

        if (!isValid) {
          e.preventDefault();
        }
      });
    });
  </script>

  <style>
    body { font-family: 'Poppins', sans-serif; background-color: #f4f7f6; }
    .container { background: #fff; padding: 40px; border-radius: 12px; max-width: 700px; width: 100%;
      box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1); margin: 40px auto; }
    .form-title { text-align: center; font-size: 26px; font-weight: 600; color: #2e7d32; margin-bottom: 10px; }
    .form-group { margin-bottom: 15px; }
    .form-group label { font-weight: 500; color: #2e7d32; display: block; margin-bottom: 6px; }
    .form-group input, .form-group select { width: 100%; padding: 14px; border: 1px solid #ddd; border-radius: 6px;
      font-size: 16px; background: #f9f9f9; }
    .form-group input:focus, .form-group select:focus { border-color: #4caf50; outline: none; }
    .form-buttons { display: flex; justify-content: space-between; margin-top: 20px; }
    .btn { padding: 14px 24px; border: none; border-radius: 6px; font-size: 16px; cursor: pointer; transition: 0.3s; }
    .btn-primary { background-color: #4caf50; color: white; }
    .btn-primary:hover { background-color: #388e3c; }
    .btn-secondary { background-color: #9e9e9e; color: white; }
    .btn-secondary:hover { background-color: #616161; }
  </style>
</head>

<body>
  <div class="container">
    <h2 class="form-title">Customer Registration</h2>

    <form method="post" action="{% url 'customerreg_process' %}" enctype="multipart/form-data">
      {% csrf_token %}

      <div class="form-group">
        <label for="customer_name">Full Name</label>
        <input type="text" name="customer_name" id="customer_name" required>
      </div>

      <div class="form-group">
        <label for="email">Email</label>
        <input type="email" name="email" id="email" required>
      </div>

      <div class="form-group">
        <label for="phone">Contact Number</label>
        <input type="text" name="phone" id="phone" required>
      </div>

      <div class="form-group">
        <label for="username">Username</label>
        <input type="text" name="username" id="username" autocomplete="off" required>
      </div>

      <div class="form-group">
        <label for="password">Password</label>
        <input type="password" name="password" id="password" autocomplete="new-password" required>
      </div>

      <div class="form-group">
        <label for="address">Address</label>
        <input type="text" name="address" id="address" required>
      </div>

      <div class="form-group">
        <label for="image">Upload Profile Picture</label>
        <input type="file" name="image" id="image" required>
      </div>

      <div class="form-group">
        <label for="idproof">Upload ID Proof</label>
        <input type="file" name="idproof" id="idproof" required>
      </div>

      <div class="form-group">
        <label for="district">District</label>
        <select id="district" name="ddldistrict" required>
          <option selected>Choose...</option>
          {% for d in district %}
            <option value="{{d.district_id}}">{{d.district_name}}</option>
          {% endfor %}
        </select>
      </div>

      <div class="form-group">
        <label for="location">Location</label>
        <select id="location" name="location" required>
          <option value="0">-----select----</option>
        </select>
      </div>

      <div class="form-buttons">
        <button type="submit" class="btn btn-primary">Register</button>
        <button type="reset" class="btn btn-secondary">Reset</button>
      </div>
    </form>
  </div>
</body>
</html>
